{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["//\u4E3B\u8981\u662F\u628Atemplate\u4E2D\u7684\u4EE3\u7801\u7F16\u8BD1\u6210render()\u51FD\u6570-render()\u51FD\u6570\u4E2DVNode\u7684\u662F\u7528\u6A21\u7248\u6765\u5199\u7684,\u800C\u4E0D\u662Fh()\u51FD\u6570\u751F\u6210\u7684;\n\nimport { NodeTypes } from \"./ast\";\n\ntype TemplateContext = {\n  line: number;//\u7B2C\u51E0\u884C;\n  column: number;//\u7B2C\u51E0\u5217;\n  offset: number;//\u504F\u79FB\u91CF;\n  source: string;//\u5F53\u524D\u8981\u88AB\u89E3\u6790\u6A21\u7248,\u6B64\u5B57\u6BB5\u4F1A\u88AB\u4E0D\u505C\u5730\u8FDB\u884C\u89E3\u6790,\u4F1Aslice()\u4E00\u76F4\u88AB\u622A\u77ED;\n  originalSource: string;//\u539F\u6A21\u7248,\u6B64\u5B57\u6BB5\u662F\u539F\u6A21\u7248,\u4E0D\u4F1A\u88AB\u89E3\u6790;\n}\nfunction createParserContext(template: string): TemplateContext {\n  const theContext: TemplateContext = {\n    line: 1,\n    column: 1,\n    offset: 0,\n    source: template,\n    originalSource: template,\n  };\n  return theContext\n}\n\n\nfunction isEnd(context: TemplateContext) {\n  const source = context.source\n  return !source;\n}\n\n//\u884C\u5217\u6E38\u6807\u4FE1\u606F,\u7528\u6765\u62A5\u9519\u4E4B\u7C7B\u7684\u7528\u5230;\ntype CursorObject = {\n  line: number;\n  column: number;\n  offset: number;\n}\n//\u5F97\u5230\u5F53\u524D\u4E0A\u4E0B\u6587\u7684\u6E38\u6807\u4FE1\u606F,\u7528\u4E8E\u62A5\u9519\u63D0\u793A\u4E4B\u7C7B\u7684;\nfunction getCursor(context: TemplateContext): CursorObject {\n  const { line, column, offset } = context\n  return { line, column, offset }\n}\n\n//\u66F4\u65B0\u6700\u65B0\u7684\u884C\u5217\u548C\u504F\u79FB\u91CF\u4FE1\u606F;\nfunction advancePositionWithMutation(context: TemplateContext, source: string, endIndex: number) {\n  let linesCount = 0;\n  let linePos = -1;\n  for (let i = 0; i < endIndex; i++) {\n    if (source.charCodeAt(i) === 10) {\n      //console.log('i--->', i)\n      linesCount++\n\n      linePos = i;\n    }\n  }\n  context.line = context.line + linesCount\n\n  //\u504F\u79FB\u91CF,\u5220\u6389\u591A\u5C11\u52A0\u591A\u5C11;\n  context.offset = context.offset + endIndex\n\n  //\u7B49\u4E8E-1,\u8BF4\u660E\u6CA1\u6709\u6362\u884C\u8FC7;\u800C\u8FD9\u4E9B\u6587\u672C\u524D,\u53EF\u80FD\u5C31\u662F\u4E2A\u6807\u7B7E,\u6240\u4EE5\u8981\u52A0\u4E4B\u524D\u7684;\n  //\u5982\u679C\u6362\u884C\u8FC7,\u90A3\u4E48linePos\u5FC5\u5B9A\u662F\u4E0A\u4E00\u884C\u4E2D\u6362\u884C\u7B26\u7684\u89D2\u6807;\n  context.column = linePos === -1 ? context.column + endIndex : endIndex - linePos\n  //console.log('linePos--->', linePos)\n  // debugger\n}\n\n//\u628A\u5F53\u524D\u4E0A\u4E0B\u6587\u7684\u5F53\u524D\u6A21\u7248\u5728\u7ED3\u675F\u89D2\u6807\u524D\u7684\u6587\u672C\u622A\u53BB;\nfunction advanceBy(context: TemplateContext, endIndex: number) {\n  //\u6BCF\u6B21\u5220\u6389\u5185\u5BB9\u7684\u65F6\u5019,\u90FD\u8981\u66F4\u65B0\u6700\u65B0\u7684\u884C\u5217\u548C\u504F\u79FB\u91CF\u4FE1\u606F;\n  const source = context.source\n  advancePositionWithMutation(context, source, endIndex)\n  context.source = source.slice(endIndex)\n}\n\n//\u622A\u53D6\u5F53\u524D\u4E0A\u4E0B\u6587\u7684\u6587\u672C\u5185\u5BB9;\nfunction parseTextData(context: TemplateContext, endIndex: number) {\n  const rawText = context.source.slice(0, endIndex)\n  advanceBy(context, endIndex)\n  // debugger\n  return rawText\n}\n\ntype SelectionObject = {\n  start: CursorObject;\n  end: CursorObject;\n  source: string;\n}\nfunction getSelection(context: TemplateContext, start: CursorObject, end?: CursorObject) {\n  end = end || getCursor(context)\n  //console.log(start.offset, end.offset)\n  const theReturn: SelectionObject = {\n    start,\n    end,\n    source: context.originalSource.slice(start.offset, end.offset)\n  }\n  return theReturn\n}\nfunction parseText(context: TemplateContext): any {\n  //\u5728\u89E3\u6790\u6587\u672C\u7684;\n  const endTokens = [`<`, `{{`]//\u7ED3\u675F\u6807\u8BC6\u5217\u8868;\n  //asafs{{d<jfhlaksdjhalkjfhd;sjfh;\n  let endIndex = context.source.length//\u9ED8\u8BA4\u4E3A\u5230\u6700\u540E\u7ED3\u675F;\n  for (let i = 0; i < endTokens.length; i++) {\n    //\u770B\u7ED3\u675F\u6807\u8BC6\u7B2C\u4E00\u6B21\u51FA\u73B0\u7684\u5730\u65B9;\n    //\u56E0\u4E3A\u8FDB\u5165parseText\u7684\u7B2C\u4E00\u4E2A\u89D2\u68070,\u5FC5\u5B9A\u4E0D\u662F\u7ED3\u675F\u6807\u8BC6;\n    const index = context.source.indexOf(endTokens[i], 1)\n    //\u627E\u5230\u4E86,\u5E76\u4E14\u7B2C\u4E00\u6B21\u6BD4\u6574\u4E2A\u5B57\u7B26\u4E32\u5C0F;\n    if (index !== -1 && endIndex > index) {\n      endIndex = index\n    }\n  }\n\n  //\u521B\u5EFA \u884C\u5217\u4FE1\u606F;\n  const start = getCursor(context)//\u5F00\u59CB;\n\n  //\u53D6\u5185\u5BB9;\n  const content = parseTextData(context, endIndex)\n  //debugger\n  return {\n    type: NodeTypes.TEXT,//\u7C7B\u578B;\n    content: content,//\u5185\u5BB9;\n    loc: getSelection(context, start),//\u4F4D\u7F6E\u4FE1\u606F;\n  }\n\n  //\u518D\u83B7\u53D6\u7ED3\u675F\u7684\u4F4D\u7F6E;\n\n  //debugger\n}\n\n\n//\u5C06html\u8BED\u6CD5\u8F6C\u6362\u6210js\u8BED\u6CD5;\nfunction parse(template: string) {\n  //\u521B\u5EFA\u4E00\u4E2A\u89E3\u6790\u7684\u4E0A\u4E0B\u6587\u6765\u8FDB\u884C\u5904\u7406;\n  const context = createParserContext(template)\n  //debugger\n\n  //< \u5143\u7D20;\n  //{{}} \u8BF4\u660E\u8868\u8FBE\u5F0F;\n  //\u5176\u5B83\u5C31\u662F\u6587\u672C;\n  //\u76EE\u524D\u4E0D\u8003\u8651\u5176\u5B83;\n  const nodes = []\n\n  for (; !isEnd(context);) {\n    const source = context.source\n    let node\n    if (source.startsWith('{{')) {\n      //\u8BF4\u660E\u8868\u8FBE\u5F0F;\n      node = 'xxx'\n    } else if (source[0] === '<') {\n      //\u5143\u7D20-\u6807\u7B7E;\n      node = 'qqq'\n    }\n    //\u6587\u672C;\n    //\u6682\u65F6\u4E0D\u8003\u8651\u5176\u5B83,\u5982\u6CE8\u91CA\u4E4B\u7C7B\u7684;\n    if (!node) {\n      node = parseText(context)\n      //break\n    }\n    nodes.push(node)\n    console.log(nodes)\n    break\n  }\n  //console.log(nodes)\n\n  return\n}\n\nexport function compile(template: string) {\n  //\u5C06\u6A21\u677F\u8F6C\u6210\u62BD\u8C61\u8BED\u6CD5\u6811;\n  const ast = parse(template);//\u8FD9\u91CC\u9700\u8981\u5C06html\u8BED\u6CD5\u8F6C\u6362\u6210js\u8BED\u6CD5;--\u7F16\u8BD1\u539F\u7406;\n\n  console.log('ast--->', ast)\n  return ast\n  //\u5BF9ast\u8BED\u6CD5\u6811\u8FDB\u884C\u4E00\u4E9B\u9884\u5148\u5904\u7406;\n  // transform(ast);//\u4F1A\u751F\u6210\u4E00\u4E9B\u4FE1\u606F;\n\n  //\u4EE3\u7801\u751F\u6210;\n  // return generate(ast);//\u6700\u7EC8\u751F\u6210\u4EE3\u7801;\u548Cvue2\u7684\u8FC7\u7A0B\u4E00\u6837;\n}\n\n\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAWA,+BAA6B,UAAmC;AAC9D,UAAM,aAA8B;AAAA,MAClC,MAAM;AAAA,MACN,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,gBAAgB;AAAA,IAClB;AACA,WAAO;AAAA,EACT;AAGA,iBAAe,SAA0B;AACvC,UAAM,SAAS,QAAQ;AACvB,WAAO,CAAC;AAAA,EACV;AASA,qBAAmB,SAAwC;AACzD,UAAM,EAAE,MAAM,QAAQ,WAAW;AACjC,WAAO,EAAE,MAAM,QAAQ,OAAO;AAAA,EAChC;AAGA,uCAAqC,SAA0B,QAAgB,UAAkB;AAC/F,QAAI,aAAa;AACjB,QAAI,UAAU;AACd,aAAS,IAAI,GAAG,IAAI,UAAU,KAAK;AACjC,UAAI,OAAO,WAAW,CAAC,MAAM,IAAI;AAE/B;AAEA,kBAAU;AAAA,MACZ;AAAA,IACF;AACA,YAAQ,OAAO,QAAQ,OAAO;AAG9B,YAAQ,SAAS,QAAQ,SAAS;AAIlC,YAAQ,SAAS,YAAY,KAAK,QAAQ,SAAS,WAAW,WAAW;AAAA,EAG3E;AAGA,qBAAmB,SAA0B,UAAkB;AAE7D,UAAM,SAAS,QAAQ;AACvB,gCAA4B,SAAS,QAAQ,QAAQ;AACrD,YAAQ,SAAS,OAAO,MAAM,QAAQ;AAAA,EACxC;AAGA,yBAAuB,SAA0B,UAAkB;AACjE,UAAM,UAAU,QAAQ,OAAO,MAAM,GAAG,QAAQ;AAChD,cAAU,SAAS,QAAQ;AAE3B,WAAO;AAAA,EACT;AAOA,wBAAsB,SAA0B,OAAqB,KAAoB;AACvF,UAAM,OAAO,UAAU,OAAO;AAE9B,UAAM,YAA6B;AAAA,MACjC;AAAA,MACA;AAAA,MACA,QAAQ,QAAQ,eAAe,MAAM,MAAM,QAAQ,IAAI,MAAM;AAAA,IAC/D;AACA,WAAO;AAAA,EACT;AACA,qBAAmB,SAA+B;AAEhD,UAAM,YAAY,CAAC,KAAK,IAAI;AAE5B,QAAI,WAAW,QAAQ,OAAO;AAC9B,aAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AAGzC,YAAM,QAAQ,QAAQ,OAAO,QAAQ,UAAU,IAAI,CAAC;AAEpD,UAAI,UAAU,MAAM,WAAW,OAAO;AACpC,mBAAW;AAAA,MACb;AAAA,IACF;AAGA,UAAM,QAAQ,UAAU,OAAO;AAG/B,UAAM,UAAU,cAAc,SAAS,QAAQ;AAE/C,WAAO;AAAA,MACL,MAAM;AAAA,MACN;AAAA,MACA,KAAK,aAAa,SAAS,KAAK;AAAA,IAClC;AAAA,EAKF;AAIA,iBAAe,UAAkB;AAE/B,UAAM,UAAU,oBAAoB,QAAQ;AAO5C,UAAM,QAAQ,CAAC;AAEf,WAAO,CAAC,MAAM,OAAO,KAAI;AACvB,YAAM,SAAS,QAAQ;AACvB,UAAI;AACJ,UAAI,OAAO,WAAW,IAAI,GAAG;AAE3B,eAAO;AAAA,MACT,WAAW,OAAO,OAAO,KAAK;AAE5B,eAAO;AAAA,MACT;AAGA,UAAI,CAAC,MAAM;AACT,eAAO,UAAU,OAAO;AAAA,MAE1B;AACA,YAAM,KAAK,IAAI;AACf,cAAQ,IAAI,KAAK;AACjB;AAAA,IACF;AAGA;AAAA,EACF;AAEO,mBAAiB,UAAkB;AAExC,UAAM,MAAM,MAAM,QAAQ;AAE1B,YAAQ,IAAI,WAAW,GAAG;AAC1B,WAAO;AAAA,EAMT;",
  "names": []
}
